<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Thumbnail Generator</title>
    <!-- Add Phosphor Icons -->
    <!-- <script src="https://unpkg.com/@phosphor-icons/web"></script> -->
    <script>
      onmessage = (event) => {
        if (event.source === window.parent.parent.parent && event.origin === "https://www.figma.com") {
          // Handle keyboard shortcuts and theme
          document.addEventListener('keydown', (e) => {
            // ... keyboard event handling code ...
          }, true);

          // Theme handling
          window.addEventListener('message', function(event) {
            if (
              event.source === window.parent.parent.parent &&
              event.data &&
              typeof event.data === 'object' &&
              'figmaMessage' in event.data
            ) {
              // ... theme handling code ...
            }
          }, true);

          // Add dark theme by default
          window.addEventListener('load', (event) => {
            document.documentElement.classList.add('figma-dark');
          });

          // Security policy violation handling
          window.addEventListener('securitypolicyviolation', (event) => {
            try {
              const url = new URL(event.blockedURI);
              console.warn(
                'Failed to load resource from',
                event.blockedURI,
                'since it is not in the list of allowed domains. Please add',
                '"' + url.origin + '"',
                'to the networkAccess > allowedDomains field in your manifest.json.'
              );
            } catch {
              // Handle invalid URLs
            }
          });
        }
      };
    </script>
    <style id="figma-style">
      :root {
        /* CSS variables for Figma theme */
        --figma-color-bg: #2c2c2c;
        /* ... other CSS variables ... */
      }
    </style>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        width: 600px;
        height: 550px;
      }

      /* Main content area */
      .main-content {
        width: 300px;
        height: 550px;
        padding: 16px 12px 16px 12px;
        border-right: 1px solid #E1E4EA;
        box-sizing: border-box;
        background: white;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .main-title {
        font-size: 14px;
        font-weight: 600;
        color: #2B303B;
        margin: 0 0 16px 0;
        flex-shrink: 0;
      }

      /* Preview panel */
      .preview-panel {
        width: 300px;
        height: 550px;
        padding: 16px 12px;
        background: white;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
      }

      .preview-header {
        font-size: 14px;
        font-weight: 600;
        color: #2B303B;
        margin-bottom: 16px;
      }

      .preview-content {
        width: 240px; /* Base width for preview */
        height: 135px; /* Maintains 16:9 ratio (240 * 9/16) */
        background: white;
        border: 1px solid #E1E4EA;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 24px auto;
        box-sizing: border-box;
        overflow: hidden;
        position: relative;
      }

      .preview-placeholder {
        font-size: 13px;
        color: #99A0AE;
        text-align: center;
        padding: 0 24px;
        position: relative;
        z-index: 1;
      }

      /* Section styles */
      .section {
        background: white;
        border: 1px solid #E1E4EA;
        border-radius: 8px;
        padding: 10px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: space-between;
        margin: 0;
        position: relative;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        transform-origin: center;
      }

      /* Add press animation */
      .section:active {
        transform: scale(0.98);
        background: #F7F9FC;
      }

      .section.active {
        background: linear-gradient(180deg, #FFFDFE 0%, #FFECF3 100%);
        border: 1px solid rgba(255, 132, 175, 0.20);
        animation: selectSection 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes selectSection {
        0% {
          transform: scale(0.98);
        }
        50% {
          transform: scale(1.02);
        }
        100% {
          transform: scale(1);
        }
      }

      .section.active .section-title {
        color: #2B303B;
        font-weight: 500;
      }

      .section:hover {
        background-color: #F2F5F8;
        transition: background-color 0.2s ease-in-out;
      }

      .section-title {
        font-size: 12px;
        font-weight: 500;
        color: #2B303B;
        margin: 0 0 4px 0;
        line-height: 120%;
      }

      .section-description {
        font-size: 10px;
        color: #99A0AE;
        margin: 0;
        font-weight: 400;
        line-height: 120%;
      }

      /* Button styles */
      .button-container {
        margin-top: 24px;
        padding: 0;
        border-top: none;
        flex-shrink: 0;
        justify-content: center;
        align-items: center;
      }

      button#generate {
        background: #E97135;
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.30);
        box-shadow: 0px 0px 0px 1px #AD4E1F;
        border-radius: 8px;
        padding: 9px 12px 9px 12px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        width: fit-content;
      }

      button#generate:hover {
        background: #D65E26;
        transition: background-color 0.2s ease;
      }

      /* Hide the old preview container */
      .preview-container {
        display: none;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 8px;
        margin-bottom: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      textarea {
        height: 80px;
        resize: vertical;
      }
      button:hover {
        background-color: #0d8de3;
      }
      .control-group {
        margin-bottom: 16px;
      }
      .control-group label {
        display: block;
        margin-bottom: 4px;
        font-size: 12px;
        color: #333;
      }
      .row {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
      }
      .row > * {
        flex: 1;
      }
      /* Add new styles */
      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 8px;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .status-text {
        font-size: 11px;
        color: #666;
      }

      .toggle-button {
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        padding: 4px 8px;
        cursor: pointer;
        color: #333;
        width: auto;
        display: flex;
        align-items: center;
        gap: 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      .toggle-button:hover {
        background-color: #e8e8e8;
        color: #18a0fb;
      }

      .toggle-button.active {
        background-color: #e3f2fd;
        color: #18a0fb;
        border-color: #18a0fb;
      }

      .toggle-text {
        font-size: 12px;
        font-weight: 500;
      }

      .description-section {
        display: none;
      }

      .description-section.active {
        display: block;
      }

      i {
        font-size: 16px;
      }

      /* Updated Preview styles */
      .preview-canvas {
        position: relative;
        width: 300px;
        height: 200px;
        margin: 16px 12px 16px 12px;
        background: #ffffff;
        overflow: hidden;
      }

      .preview-canvas.with-gradient::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0) 0%,
          rgba(0, 0, 0, 0.7) 100%
        );
        pointer-events: none;
      }

      .preview-heading {
        font-size: calc(var(--heading-size, 32px) * 1);
        line-height: 1.2;
        margin-bottom: 32px;
        width: 100%;
        text-align: center;
      }

      .preview-description {
        font-size: calc(var(--description-size, 16px) * 1);
        line-height: 1.4;
        width: 100%;
        text-align: center;
      }

      /* Remove the safe area visual guide since it's not shown in Figma's UI */
      .safe-area {
        display: none;
      }

      .background-section,
      .heading-section {
        display: none;
      }

      .background-section.active,
      .heading-section.active {
        display: block;
      }

      .color-input-group {
        flex: 1;
      }

      .gradient-toggle {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .gradient-toggle input[type="checkbox"] {
        width: auto;
        margin: 0;
      }

      /* Update preview styles */
      .preview-canvas {
        background: white;
      }

      .preview-canvas.with-gradient::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0) 0%,
          rgba(0, 0, 0, 0.7) 100%
        );
        pointer-events: none;
      }

      .position-select {
        width: auto;
        min-width: 100px;
      }

      .position-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }

      .position-row label {
        margin-bottom: 0;
        white-space: nowrap;
      }

      .position-input-group {
        flex: 1;
      }

      .position-input-group select {
        width: 100%;
      }

      /* Remove tag-related styles */
      /* .tags-section,
      .tag-item,
      .tag-header,
      .tag-title,
      .remove-tag,
      .add-tag-button {
        display: none;
      } */

      /* Add these styles and remove the display: none from existing tag styles */
      .tags-section {
        display: none;
      }

      .tags-section.active {
        display: block;
      }

      .tag-item {
        background: #FFFFFF;
        border: 1px solid #E1E4EA;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 8px;
      }

      .tag-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .tag-title {
        font-size: 12px;
        font-weight: 500;
        color: #2B303B;
      }

      .remove-tag {
        background: none;
        border: none;
        padding: 4px;
        cursor: pointer;
        color: #99A0AE;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .remove-tag:hover {
        color: #FF4D4D;
      }

      .tag-preview {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
      }

      #tagPropertiesForm {
        background: #F7F9FC;
        border: 1px solid #E1E4EA;
        border-radius: 6px;
        padding: 12px;
        margin-top: 12px;
      }

      .add-tag-form-buttons {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }

      .add-tag-form-buttons button {
        flex: 1;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
      }

      .add-tag-form-buttons .cancel {
        background: #FFFFFF;
        border: 1px solid #E1E4EA;
        color: #2B303B;
      }

      .add-tag-form-buttons .add {
        background: #2B303B;
        border: 1px solid #2B303B;
        color: #FFFFFF;
      }

      .contributors-section {
        display: none;
      }

      .contributors-section.active {
        display: block;
      }

      .contributor-item {
        background: #FFFFFF;
        border: 1px solid #E1E4EA;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 8px;
      }

      .contributor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .contributor-preview {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .contributor-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #F5F5F5;
        background-size: cover;
        background-position: center;
      }

      .display-options {
        margin: 12px 0;
      }

      .display-mode-select {
        width: 100%;
      }

      .add-contributor-button {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        margin-top: 8px;
      }

      /* Remove AI-related styles */
      .ai-section,
      .ai-content,
      .ai-prompt,
      .ai-options,
      .ask-ai-button {
        display: none;
      }

      /* Section grid layout */
      .sections-grid {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 8px;
        overflow-y: auto;
        padding-right: 8px;
      }

      /* Update two-column layout */
      .two-column-sections {
        display: flex;
        gap: 12px;
        margin: 0;
      }

      .two-column-sections .section {
        flex: 1;
      }

      /* Update icon styles */
      .section-icon {
        width: 16px;
        height: 16px;
        margin-bottom: 12px;
        color: #2B303B;
      }

      /* Add properties panel styles */
      .properties-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .properties-header {
        font-size: 14px;
        font-weight: 600;
        color: #2B303B;
        flex-shrink: 0;
      }

      .properties-content {
        flex: 1;
        padding: 16px;
        overflow-y: auto;
      }

      /* Property group styles */
      .property-group {
        margin-bottom: 16px;
      }

      .property-group-title {
        font-size: 12px;
        font-weight: 500;
        color: #2B303B;
        margin-bottom: 8px;
      }

      /* Property input styles */
      .property-input {
        margin-bottom: 12px;
      }

      .property-input label {
        display: block;
        font-size: 11px;
        color: #99A0AE;
        margin-bottom: 4px;
      }

      .property-input input,
      .property-input select {
        width: 100%;
        padding: 8px;
        border: 1px solid #E1E4EA;
        border-radius: 6px;
        font-size: 12px;
        color: #2B303B;
      }

      /* Color picker styles */
      .color-picker-input {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .color-preview {
        width: 32px;
        height: 32px;
        border-radius: 4px;
        border: 1px solid #E1E4EA;
      }

      /* Update preview elements container styles */
      .preview-elements {
        width: 1920px; /* Original width */
        height: 1080px; /* Original height */
        transform: scale(0.125); /* Scale down 1920 to 240 (240/1920 = 0.125) */
        transform-origin: center center;
        position: absolute;
        display: flex;
        flex-direction: column;
        padding: 120px 160px; /* Match SAFE_SPACE from TypeScript */
        box-sizing: border-box;
      }

      /* Add styles for the add tag button in the header */
      .properties-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .add-tag-header-button {
        font-size: 12px;
        padding: 4px 8px;
        background: #F5F5F5;
        border: 1px solid #E1E4EA;
        border-radius: 4px;
        color: #2B303B;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 4px;
        transition: all 0.2s ease;
      }

      .add-tag-header-button:hover {
        background: #EAEAEA;
        border-color: #D1D5DB;
      }

      /* Contributor styles */
      .contributor-item {
        background: #FFFFFF;
        border: 1px solid #E1E4EA;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 8px;
      }

      .contributor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .contributor-title {
        font-size: 12px;
        font-weight: 500;
        color: #2B303B;
      }

      .remove-contributor {
        background: none;
        border: none;
        padding: 4px;
        cursor: pointer;
        color: #99A0AE;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .remove-contributor:hover {
        color: #FF4D4D;
      }

      .contributor-preview {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .contributor-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #F5F5F5;
        background-size: cover;
        background-position: center;
      }

      #contributorPropertiesForm {
        background: #F7F9FC;
        border: 1px solid #E1E4EA;
        border-radius: 6px;
        padding: 12px;
        margin-top: 12px;
      }
    </style>
  </head>
  <body>
    <!-- Main content area -->
    <div class="main-content">
      <h1 class="main-title">Thumbnail Generator</h1>
      <div class="sections-grid">
        <!-- Background section (full width) -->
        <div class="section" id="backgroundSection">
          <svg class="section-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13.0001 8.7175L8.01072 13.7069C7.91786 13.7998 7.80761 13.8734 7.68627 13.9237C7.56493 13.974 7.43487 13.9998 7.30353 13.9998C7.17219 13.9998 7.04213 13.974 6.92079 13.9237C6.79945 13.8734 6.6892 13.7998 6.59634 13.7069L1.29322 8.40375C1.20034 8.31089 1.12666 8.20064 1.07639 8.0793C1.02612 7.95796 1.00024 7.8279 1.00024 7.69656C1.00024 7.56522 1.02612 7.43517 1.07639 7.31383C1.12666 7.19249 1.20034 7.08224 1.29322 6.98938L7.28259 1L14.5001 8.2175L13.0001 8.7175Z" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M7.75 8.5C8.44036 8.5 9 7.94036 9 7.25C9 6.55964 8.44036 6 7.75 6C7.05964 6 6.5 6.55964 6.5 7.25C6.5 7.94036 7.05964 8.5 7.75 8.5Z" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M6.86614 6.36625L2.49927 2" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15.5 13C15.5 13.2652 15.3946 13.5196 15.2071 13.7071C15.0196 13.8946 14.7652 14 14.5 14C14.2348 14 13.9804 13.8946 13.7929 13.7071C13.6054 13.5196 13.5 13.2652 13.5 13C13.5 12 14.5 10.5 14.5 10.5C14.5 10.5 15.5 12 15.5 13Z" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          <div class="section-title">Background</div>
          <div class="section-description">Customise the background</div>
        </div>

        <!-- Two-column sections -->
         <div class="two-column-sections"> 
           <div class="section" id="headingSection">
            <svg class="section-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M2.5 3.5V11" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9 7.25H2.5" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9 3.5V11" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M14 13V7L12.5 8" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>              
             <div class="section-title">Heading</div>
             <div class="section-description">Add project heading</div>
           </div>
   
           <div class="section" id="descriptionSection">
            <svg class="section-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 3.5V12.5" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3.5 5.5V3.5H12.5V5.5" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6 12.5H10" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              
             <div class="section-title">Description</div>
             <div class="section-description">Add project description</div>
           </div>
         </div>

         <div class="two-column-sections">
          <div id="tagsSection" class="section">
            <svg class="section-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13.5 8.5L8.5 13.5C8.36739 13.6326 8.19021 13.7066 8.00552 13.7066C7.82084 13.7066 7.64366 13.6326 7.51104 13.5L2.5 8.5V2.5H8.5L13.5 7.5V8.5Z" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M5 5H5.01" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div class="section-title">Tags</div>
            <div class="section-description">Add project tags</div>
          </div>

          <div class="section" id="contributorsSection">
            <svg class="section-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 10C10.2091 10 12 8.20914 12 6C12 3.79086 10.2091 2 8 2C5.79086 2 4 3.79086 4 6C4 8.20914 5.79086 10 8 10Z" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M2 13.5C3.21063 11.4081 5.40937 10 8 10C10.5906 10 12.7894 11.4081 14 13.5" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              
            <div class="section-title">Contributors</div>
            <div class="section-description">Add project contributors</div>
          </div>
         </div>
      </div>
      <div class="button-container">
        <button id="generate">Generate thumbnail</button>
      </div>
    </div>

    <!-- Preview panel -->
    <div class="preview-panel">
      <!-- Preview section -->


         <div class="preview-header">
           Preview
         </div>
         <div class="preview-content">
           <div class="preview-placeholder">
             Select an element to preview
           </div>
         </div>

      
      <!-- Properties section -->

         <div class="properties-panel">
           <div class="properties-header">
             Select an element to edit properties
           </div>
           <div class="properties-content">
             <!-- Background properties -->
             <div id="backgroundProperties" class="property-group" style="display: none;">
               <div class="property-input">
                 <label>Background Color</label>
                 <div class="color-picker-input">
                   <input type="color" id="backgroundColor" value="#FFFFFF">
                   <div class="color-preview" style="background-color: #FFFFFF"></div>
                 </div>
               </div>
               <div class="property-input">
                 <label>
                   <input type="checkbox" id="gradientToggle">
                   Add gradient overlay
                 </label>
               </div>
             </div>

             <!-- Heading properties -->
             <div id="headingProperties" class="property-group" style="display: none;">
               <div class="property-input">
                 <label>Heading Text</label>
                 <input type="text" id="headingText" placeholder="Enter heading">
               </div>
               <div class="property-input">
                 <label>Font Size</label>
                 <input type="number" id="headingSize" value="32" min="12" max="96">
               </div>
               <div class="property-input">
                 <label>Color</label>
                 <input type="color" id="headingColor" value="#000000">
               </div>
             </div>

             <!-- Description properties -->
             <div id="descriptionProperties" class="property-group" style="display: none;">
               <div class="property-input">
                 <label>Description Text</label>
                 <textarea id="descriptionText" placeholder="Enter description"></textarea>
               </div>
               <div class="property-input">
                 <label>Font Size</label>
                 <input type="number" id="descriptionSize" value="16" min="10" max="48">
               </div>
               <div class="property-input">
                 <label>Color</label>
                 <input type="color" id="descriptionColor" value="#666666">
               </div>
             </div>

             <!-- Tags properties -->
             <div id="tagsProperties" class="property-group" style="display: none;">
               <div id="tagsList">
                 <!-- Tags will be listed here -->
               </div>
               <div id="tagPropertiesForm" style="display: none;">
                 <div class="property-input">
                   <label>Tag Text</label>
                   <input type="text" id="tagText" placeholder="Enter tag text">
                 </div>
                 <div class="property-input">
                   <label>Fill Color</label>
                   <input type="color" id="tagFillColor" value="#E1E4EA">
                 </div>
                 <div class="property-input">
                   <label>Text Color</label>
                   <input type="color" id="tagTextColor" value="#2B303B">
                 </div>
                 <div class="add-tag-form-buttons">
                   <button class="cancel" onclick="document.getElementById('tagPropertiesForm').style.display='none'">Cancel</button>
                   <button class="add" onclick="addNewTag(
                     document.getElementById('tagText').value,
                     document.getElementById('tagFillColor').value,
                     document.getElementById('tagTextColor').value
                   )">Add Tag</button>
                 </div>
               </div>
             </div>

             <!-- Contributors properties -->
             <div id="contributorsProperties" class="property-group" style="display: none;">
               <div class="property-input">
                 <label>Display Mode</label>
                 <select id="contributorsDisplayMode" onchange="state.contributors.displayMode = this.value; updatePreview();">
                   <option value="both">Show avatars and names</option>
                   <option value="avatars-only">Show avatars only</option>
                   <option value="names-only">Show names only</option>
                 </select>
               </div>
               
               <div id="contributorsList">
                 <!-- Contributors will be listed here -->
               </div>
               
               <div id="contributorPropertiesForm" style="display: none;">
                 <div class="property-input">
                   <label>Name</label>
                   <input type="text" id="contributorName" placeholder="Enter contributor name">
                 </div>
                 <div class="property-input">
                   <label>Avatar URL</label>
                   <input type="text" id="contributorAvatarUrl" placeholder="Enter avatar URL">
                 </div>
                 <div class="add-tag-form-buttons">
                   <button class="cancel" onclick="document.getElementById('contributorPropertiesForm').style.display='none'">Cancel</button>
                   <button class="add" onclick="addNewContributor(
                     document.getElementById('contributorName').value,
                     document.getElementById('contributorAvatarUrl').value
                   )">Add Contributor</button>
                 </div>
               </div>
             </div>
           </div>
         </div>

    </div>

    <script>
      // Get all sections and property groups
      const sections = document.querySelectorAll('.section');
      const propertyGroups = document.querySelectorAll('.property-group');
      const propertiesHeader = document.querySelector('.properties-header');
      const previewContent = document.querySelector('.preview-content');
      const previewPlaceholder = document.querySelector('.preview-placeholder');
      const generateButton = document.getElementById('generate');

      // State object to store current values
      const state = {
        background: {
          color: '#FFFFFF',
          gradient: false
        },
        heading: {
          text: '',
          size: 32,
          color: '#000000'
        },
        description: {
          text: '',
          size: 16,
          color: '#666666'
        },
        tags: [],
        contributors: {
          items: [],
          displayMode: 'both' // 'avatars-only' | 'names-only' | 'both'
        }
      };

      // Get all input elements
      const backgroundColorInput = document.getElementById('backgroundColor');
      const gradientToggle = document.getElementById('gradientToggle');
      const headingTextInput = document.getElementById('headingText');
      const headingSizeInput = document.getElementById('headingSize');
      const headingColorInput = document.getElementById('headingColor');
      const descriptionTextInput = document.getElementById('descriptionText');
      const descriptionSizeInput = document.getElementById('descriptionSize');
      const descriptionColorInput = document.getElementById('descriptionColor');

      // Add input event listeners
      backgroundColorInput.addEventListener('input', (e) => {
        state.background.color = e.target.value;
        updatePreview();
      });

      gradientToggle.addEventListener('change', (e) => {
        state.background.gradient = e.target.checked;
        updatePreview();
      });

      headingTextInput.addEventListener('input', (e) => {
        state.heading.text = e.target.value;
        updatePreview();
      });

      headingSizeInput.addEventListener('input', (e) => {
        state.heading.size = parseInt(e.target.value);
        updatePreview();
      });

      headingColorInput.addEventListener('input', (e) => {
        state.heading.color = e.target.value;
        updatePreview();
      });

      descriptionTextInput.addEventListener('input', (e) => {
        state.description.text = e.target.value;
        updatePreview();
      });

      descriptionSizeInput.addEventListener('input', (e) => {
        state.description.size = parseInt(e.target.value);
        updatePreview();
      });

      descriptionColorInput.addEventListener('input', (e) => {
        state.description.color = e.target.value;
        updatePreview();
      });

      // Add click event listeners for sections
      sections.forEach(section => {
        section.addEventListener('click', () => {
          // Remove active class from all sections
          sections.forEach(s => s.classList.remove('active'));
          
          // Add active class to clicked section
          section.classList.add('active');
          
          // Get the corresponding properties group ID
          const propertiesId = section.id.replace('Section', 'Properties');
          
          // Show the corresponding properties
          showPropertyGroup(propertiesId);
        });
      });

      function showPropertyGroup(groupId) {
        // Hide all property groups first
        propertyGroups.forEach(group => {
          group.style.display = 'none';
        });
        
        // Show the selected group
        const selectedGroup = document.getElementById(groupId);
        if (selectedGroup) {
          selectedGroup.style.display = 'block';
        }

        // Update properties header text and button
        propertiesHeader.innerHTML = '';  // Clear existing content
        
        // Add the title text
        const titleText = document.createElement('span');
        const activeSection = document.querySelector('.section.active');
        titleText.textContent = activeSection.querySelector('.section-title').textContent + ' Properties';
        propertiesHeader.appendChild(titleText);

        // Add the "Add new tag" button if we're showing tag properties
        if (groupId === 'tagsProperties') {
          const addButton = document.createElement('button');
          addButton.className = 'add-tag-header-button';
          addButton.innerHTML = `
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 2.5V9.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M2.5 6H9.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Add new tag</span>
          `;
          addButton.onclick = () => {
            const tagPropertiesForm = document.getElementById('tagPropertiesForm');
            if (tagPropertiesForm) {
              tagPropertiesForm.style.display = 'block';
            }
          };
          propertiesHeader.appendChild(addButton);
        }

        // Add the "Add new contributor" button if we're showing contributor properties
        if (groupId === 'contributorsProperties') {
          const addButton = document.createElement('button');
          addButton.className = 'add-tag-header-button';
          addButton.innerHTML = `
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 2.5V9.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M2.5 6H9.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Add new contributor</span>
          `;
          addButton.onclick = () => {
            const contributorPropertiesForm = document.getElementById('contributorPropertiesForm');
            if (contributorPropertiesForm) {
              contributorPropertiesForm.style.display = 'block';
            }
          };
          propertiesHeader.appendChild(addButton);
        }
      }

      // Add function to handle adding new tags
      function addNewTag(text, fillColor, textColor) {
        const tag = {
          text,
          fillColor,
          textColor
        };
        
        state.tags.push(tag);
        
        // Update tags list
        updateTagsList();
        
        // Update preview
        updatePreview();
      }

      // Add function to update tags list
      function updateTagsList() {
        const tagsList = document.getElementById('tagsList');
        tagsList.innerHTML = '';
        
        state.tags.forEach((tag, index) => {
          const tagItem = document.createElement('div');
          tagItem.className = 'tag-item';
          tagItem.innerHTML = `
            <div class="tag-header">
              <span class="tag-title">${tag.text}</span>
              <button class="remove-tag" onclick="removeTag(${index})">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 3L3 9" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M3 3L9 9" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
            <div class="tag-preview" style="background-color: ${tag.fillColor}; color: ${tag.textColor}">
              ${tag.text}
            </div>
          `;
          tagsList.appendChild(tagItem);
        });
      }

      // Add function to remove tags
      function removeTag(index) {
        state.tags.splice(index, 1);
        updateTagsList();
        updatePreview();
      }

      // Add function to handle adding new contributors
      function addNewContributor(name, avatarUrl) {
        const contributor = {
          name,
          avatarUrl
        };
        
        state.contributors.items.push(contributor);
        updateContributorsList();
        updatePreview();
      }

      // Add function to update contributors list
      function updateContributorsList() {
        const contributorsList = document.getElementById('contributorsList');
        contributorsList.innerHTML = '';
        
        state.contributors.items.forEach((contributor, index) => {
          const contributorItem = document.createElement('div');
          contributorItem.className = 'contributor-item';
          contributorItem.innerHTML = `
            <div class="contributor-header">
              <span class="contributor-title">${contributor.name}</span>
              <button class="remove-contributor" onclick="removeContributor(${index})">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 3L3 9" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M3 3L9 9" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
            <div class="contributor-preview">
              <div class="contributor-avatar" style="background-image: url(${contributor.avatarUrl})"></div>
              <span>${contributor.name}</span>
            </div>
          `;
          contributorsList.appendChild(contributorItem);
        });
      }

      // Add function to remove contributors
      function removeContributor(index) {
        state.contributors.items.splice(index, 1);
        updateContributorsList();
        updatePreview();
      }

      // Initialize when DOM is loaded
      window.addEventListener('DOMContentLoaded', () => {
        // Show background section properties by default
        const backgroundSection = document.getElementById('backgroundSection');
        if (backgroundSection) {
          backgroundSection.classList.add('active');
          showPropertyGroup('backgroundProperties');
          propertiesHeader.textContent = 'Background Properties';
        }

        // Initialize preview with default state
        updatePreview();
      });

      function updatePreview() {
        // Update background
        if (state.background.gradient) {
          previewContent.style.background = `linear-gradient(180deg, ${state.background.color} 0%, rgba(0, 0, 0, 0.7) 100%)`;
        } else {
          previewContent.style.background = state.background.color;
        }

        // Clear existing preview content except placeholder
        const elements = previewContent.querySelectorAll(':not(.preview-placeholder)');
        elements.forEach(el => el.remove());

        // Create preview elements container
        const previewElements = document.createElement('div');
        previewElements.className = 'preview-elements';

        // Add heading if exists
        if (state.heading.text) {
          const heading = document.createElement('div');
          heading.className = 'preview-heading';
          heading.textContent = state.heading.text;
          heading.style.fontSize = `${state.heading.size}px`;
          heading.style.color = state.heading.color;
          heading.style.fontWeight = '600';
          previewElements.appendChild(heading);
        }

        // Add description if exists
        if (state.description.text) {
          const description = document.createElement('div');
          description.className = 'preview-description';
          description.textContent = state.description.text;
          description.style.fontSize = `${state.description.size}px`;
          description.style.color = state.description.color;
          previewElements.appendChild(description);
        }

        // Add elements to preview if there's content
        if (state.heading.text || state.description.text) {
          previewContent.appendChild(previewElements);
          previewPlaceholder.style.display = 'none';
        } else {
          previewPlaceholder.style.display = 'block';
        }
      }

      // Handle generate button click
      generateButton.addEventListener('click', () => {
        parent.postMessage({ 
          pluginMessage: {
            type: 'generate-thumbnail',
            heading: state.heading.text,
            description: state.description.text,
            styles: {
              background: state.background,
              heading: {
                size: state.heading.size,
                color: state.heading.color,
                font: 'Inter',
                weight: 'Bold',
                position: 'center'
              },
              description: {
                size: state.description.size,
                color: state.description.color,
                font: 'Inter',
                weight: 'Regular',
                position: 'center'
              },
              contributors: state.contributors
            }
          }
        }, '*');
      });
    </script>
  </body>
</html>
