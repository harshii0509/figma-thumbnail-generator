<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Thumbnail Generator</title>
    <!-- Add Phosphor Icons -->
    <!-- <script src="https://unpkg.com/@phosphor-icons/web"></script> -->
    <script>
      onmessage = (event) => {
        if (event.source === window.parent.parent.parent && event.origin === "https://www.figma.com") {
          // Handle keyboard shortcuts and theme
          document.addEventListener('keydown', (e) => {
            // ... keyboard event handling code ...
          }, true);

          // Theme handling
          window.addEventListener('message', function(event) {
            if (
              event.source === window.parent.parent.parent &&
              event.data &&
              typeof event.data === 'object' &&
              'figmaMessage' in event.data
            ) {
              // ... theme handling code ...
            }
          }, true);

          // Add dark theme by default
          window.addEventListener('load', (event) => {
            document.documentElement.classList.add('figma-dark');
          });

          // Security policy violation handling
          window.addEventListener('securitypolicyviolation', (event) => {
            try {
              const url = new URL(event.blockedURI);
              console.warn(
                'Failed to load resource from',
                event.blockedURI,
                'since it is not in the list of allowed domains. Please add',
                '"' + url.origin + '"',
                'to the networkAccess > allowedDomains field in your manifest.json.'
              );
            } catch {
              // Handle invalid URLs
            }
          });
        }
      };
    </script>
    <style id="figma-style">
      :root {
        /* CSS variables for Figma theme */
        --figma-color-bg: #2c2c2c;
        /* ... other CSS variables ... */
      }
    </style>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        margin: 0;
        padding: 0;
        display: flex;
        width: 600px;
        height: 550px;
      }

      /* Main content area */
      .main-content {
        width: 300px;
        height: 550px;
        padding: 16px 12px 16px 12px;
        border-right: 1px solid #E1E4EA;
        box-sizing: border-box;
        background: white;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .main-title {
        font-size: 14px;
        font-weight: 600;
        color: #2B303B;
        margin: 0 0 16px 0;
        flex-shrink: 0;
      }

      /* Preview panel */
      .preview-panel {
        width: 300px;
        height: 550px;
        padding: 16px 12px;
        background: white;
        display: flex;
        flex-direction: column;
        box-sizing: border-box;
      }

      .preview-header {
        font-size: 14px;
        font-weight: 600;
        color: #2B303B;
        margin-bottom: 16px;
      }

      .preview-content {
        width: 240px; /* Base width for preview */
        height: 135px; /* Maintains 16:9 ratio (240 * 9/16) */
        background: white;
        border: 1px solid #E1E4EA;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 24px auto;
        box-sizing: border-box;
        overflow: hidden;
        position: relative;
      }

      .preview-placeholder {
        font-size: 13px;
        color: #99A0AE;
        text-align: center;
        padding: 0 24px;
        position: relative;
        z-index: 1;
      }

      /* Section styles */
      .section {
        background: white;
        border: 1px solid #E1E4EA;
        border-radius: 8px;
        padding: 10px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        justify-content: space-between;
        margin: 0;
        position: relative;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        transform-origin: center;
      }

      /* Add press animation */
      .section:active {
        transform: scale(0.98);
        background: #F7F9FC;
      }

      .section.active {
        background: linear-gradient(180deg, #FFFDFE 0%, #FFECF3 100%);
        border: 1px solid rgba(255, 132, 175, 0.20);
        animation: selectSection 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @keyframes selectSection {
        0% {
          transform: scale(0.98);
        }
        50% {
          transform: scale(1.02);
        }
        100% {
          transform: scale(1);
        }
      }

      .section.active .section-title {
        color: #2B303B;
        font-weight: 500;
      }

      .section:hover {
        background-color: #F2F5F8;
        transition: background-color 0.2s ease-in-out;
      }

      .section-title {
        font-size: 12px;
        font-weight: 500;
        color: #2B303B;
        margin: 0 0 4px 0;
        line-height: 120%;
      }

      .section-description {
        font-size: 10px;
        color: #99A0AE;
        margin: 0;
        font-weight: 400;
        line-height: 120%;
      }

      /* Button styles */
      .button-container {
        margin-top: 24px;
        padding: 0;
        border-top: none;
        flex-shrink: 0;
        justify-content: center;
        align-items: center;
      }

      button#generate {
        background: #E97135;
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.30);
        box-shadow: 0px 0px 0px 1px #AD4E1F;
        border-radius: 8px;
        padding: 9px 12px 9px 12px;
        font-size: 12px;
        font-weight: 500;
        cursor: pointer;
        width: fit-content;
      }

      button#generate:hover {
        background: #D65E26;
        transition: background-color 0.2s ease;
      }

      /* Hide the old preview container */
      .preview-container {
        display: none;
      }

      input,
      textarea,
      select {
        width: 100%;
        padding: 8px;
        margin-bottom: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }
      textarea {
        height: 80px;
        resize: vertical;
      }
      button:hover {
        background-color: #0d8de3;
      }
      .control-group {
        margin-bottom: 16px;
      }
      .control-group label {
        display: block;
        margin-bottom: 4px;
        font-size: 12px;
        color: #333;
      }
      .row {
        display: flex;
        gap: 8px;
        margin-bottom: 8px;
      }
      .row > * {
        flex: 1;
      }
      /* Add new styles */
      .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 8px;
      }

      .header-left {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .status-text {
        font-size: 11px;
        color: #666;
      }

      .toggle-button {
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        padding: 4px 8px;
        cursor: pointer;
        color: #333;
        width: auto;
        display: flex;
        align-items: center;
        gap: 4px;
        border-radius: 4px;
        transition: all 0.2s ease;
      }

      .toggle-button:hover {
        background-color: #e8e8e8;
        color: #18a0fb;
      }

      .toggle-button.active {
        background-color: #e3f2fd;
        color: #18a0fb;
        border-color: #18a0fb;
      }

      .toggle-text {
        font-size: 12px;
        font-weight: 500;
      }

      .description-section {
        display: none;
      }

      .description-section.active {
        display: block;
      }

      i {
        font-size: 16px;
      }

      /* Updated Preview styles */
      .preview-canvas {
        position: relative;
        width: 300px;
        height: 200px;
        margin: 16px 12px 16px 12px;
        background: #ffffff;
        overflow: hidden;
      }

      .preview-canvas.with-gradient::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0) 0%,
          rgba(0, 0, 0, 0.7) 100%
        );
        pointer-events: none;
      }

      .preview-heading {
        font-size: calc(var(--heading-size, 32px) * 1);
        line-height: 1.2;
        margin-bottom: 32px;
        width: 100%;
        text-align: center;
      }

      .preview-description {
        font-size: calc(var(--description-size, 16px) * 1);
        line-height: 1.4;
        width: 100%;
        text-align: center;
      }

      /* Remove the safe area visual guide since it's not shown in Figma's UI */
      .safe-area {
        display: none;
      }

      .background-section,
      .heading-section {
        display: none;
      }

      .background-section.active,
      .heading-section.active {
        display: block;
      }

      .color-input-group {
        flex: 1;
      }

      .gradient-toggle {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .gradient-toggle input[type="checkbox"] {
        width: auto;
        margin: 0;
      }

      /* Update preview styles */
      .preview-canvas {
        background: white;
      }

      .preview-canvas.with-gradient::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: linear-gradient(
          180deg,
          rgba(0, 0, 0, 0) 0%,
          rgba(0, 0, 0, 0.7) 100%
        );
        pointer-events: none;
      }

      .position-select {
        width: auto;
        min-width: 100px;
      }

      .position-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
      }

      .position-row label {
        margin-bottom: 0;
        white-space: nowrap;
      }

      .position-input-group {
        flex: 1;
      }

      .position-input-group select {
        width: 100%;
      }

      /* Remove tag-related styles */
      /* .tags-section,
      .tag-item,
      .tag-header,
      .tag-title,
      .remove-tag,
      .add-tag-button {
        display: none;
      } */

      /* Add these styles and remove the display: none from existing tag styles */
      .tags-section {
        display: none;
      }

      .tags-section.active {
        display: block;
      }

      .tag-item {
        background: #FFFFFF;
        border: 1px solid #E1E4EA;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 8px;
      }

      .tag-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .tag-title {
        font-size: 12px;
        font-weight: 500;
        color: #2B303B;
      }

      .remove-tag {
        background: none;
        border: none;
        padding: 4px;
        cursor: pointer;
        color: #99A0AE;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .remove-tag:hover {
        color: #FF4D4D;
      }

      .tag-preview {
        display: inline-block;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
      }

      #tagPropertiesForm {
        background: #F7F9FC;
        border: 1px solid #E1E4EA;
        border-radius: 6px;
        padding: 12px;
        margin-top: 12px;
      }

      .add-tag-form-buttons {
        display: flex;
        gap: 8px;
        margin-top: 12px;
      }

      .add-tag-form-buttons button {
        flex: 1;
        padding: 6px 12px;
        border-radius: 4px;
        font-size: 12px;
        cursor: pointer;
      }

      .add-tag-form-buttons .cancel {
        background: #FFFFFF;
        border: 1px solid #E1E4EA;
        color: #2B303B;
      }

      .add-tag-form-buttons .add {
        background: #2B303B;
        border: 1px solid #2B303B;
        color: #FFFFFF;
      }

      .contributors-section {
        display: none;
      }

      .contributors-section.active {
        display: block;
      }

      .contributor-item {
        background: #FFFFFF;
        border: 1px solid #E1E4EA;
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 8px;
      }

      .contributor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .contributor-preview {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .contributor-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #F5F5F5;
        background-size: cover;
        background-position: center;
      }

      .display-options {
        margin: 12px 0;
      }

      .display-mode-select {
        width: 100%;
      }

      .add-contributor-button {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 4px;
        margin-top: 8px;
      }

      /* Remove AI-related styles */
      .ai-section,
      .ai-content,
      .ai-prompt,
      .ai-options,
      .ask-ai-button {
        display: none;
      }

      /* Section grid layout */
      .sections-grid {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 8px;
        overflow-y: auto;
        padding-right: 8px;
      }

      /* Update two-column layout */
      .two-column-sections {
        display: flex;
        gap: 12px;
        margin: 0;
      }

      .two-column-sections .section {
        flex: 1;
      }

      /* Update icon styles */
      .section-icon {
        width: 16px;
        height: 16px;
        margin-bottom: 12px;
        color: #2B303B;
      }

      /* Add properties panel styles */
      .properties-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        overflow: hidden;
        width: 100%;
      }

      .properties-header {
        font-size: 14px;
        font-weight: 600;
        color: #2B303B;
        flex-shrink: 0;
      }

      .properties-content {
        flex: 1;
        margin-top: 8px;
      }

      /* Property group styles */

      .property-group-title {
        font-weight: 500;
        color: #2B303B;
        margin-bottom: 8px;;
      }

      /* Property input styles */
  
      .property-input label {
        display: block;
        font-size: 10px;
        color: #99A0AE;
        margin-bottom: 4px;
        line-height: 120%;
      }

      .property-input input,
      .property-input select,
      .hex-input,
      .rgb-input input,
      .font-size-input,
      #headingText {
        width: 100%;
        padding: 8px;
        border-radius: 4px;
        font-size: 12px;
        color: #2B303B;
        background: rgba(14, 18, 27, 0.05);
        border: none;
        box-sizing: border-box;
      }

      /* Color picker styles */
      .color-picker-wrapper {
        position: relative;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .color-preview {
        width: 28px;
        height: 28px;
        border-radius: 4px;
        border: none;
        background: rgba(14, 18, 27, 0.05);
        flex-shrink: 0;
        cursor: pointer;
        position: relative;
        border: 1px solid rgba(14, 18, 27, 0.2);
        transition: border-color 0.2s ease;
      }

      .color-preview:hover {
        border-color: #99A0AE;
      }

      /* Keep the native color picker hidden but functional as backup */
      .color-input-hidden {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }

      .custom-color-picker {
        position: fixed; /* Change to fixed positioning */
        background: white;
        border: 1px solid #E1E4EA;
        border-radius: 8px;
        padding: 8px;
        width: 200px;
        display: none;
        z-index: 1000;
      }

      .custom-color-picker.active {
        display: block;
        animation: fadeIn 0.2s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-4px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .color-slider {
        width: 100%;
        height: 8px;
        border-radius: 4px;
        margin-bottom: 8px;
        position: relative;
        cursor: pointer;
      }

      .hue-slider {
        background: linear-gradient(to right, 
          #ff0000 0%, #ffff00 17%, 
          #00ff00 33%, #00ffff 50%, 
          #0000ff 67%, #ff00ff 83%, 
          #ff0000 100%);
      }

      .saturation-value-picker {
        width: 100%;
        height: 120px;
        border-radius: 6px;
        margin-bottom: 8px;
        position: relative;
        cursor: crosshair;
        background: linear-gradient(to right, white, red);
      }

      .saturation-value-picker::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(to bottom, transparent, black);
        border-radius: 6px;
      }

      .color-picker-thumb {
        width: 10px;
        height: 10px;
        border-radius: 50%;
        border: 2px solid white;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.2);
        position: absolute;
        pointer-events: none;
      }

      .preset-colors {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 4px;
        margin-top: 8px;
      }

      .preset-color {
        width: 100%;
        padding-bottom: 100%;
        border-radius: 4px;
        cursor: pointer;
        border: 1px solid #E1E4EA;
        transition: transform 0.2s ease;
      }

      .preset-color:hover {
        transform: scale(1.1);
      }

      .rgb-inputs {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 4px;
        margin-top: 8px;
      }

      .rgb-input {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .rgb-input label {
        font-size: 10px;
        color: #99A0AE;
      }

      .rgb-input input {
        width: 100%;
        height: 24px;
        font-size: 11px;
        color: #2B303B;
        padding: 0 6px;
        background: rgba(14, 18, 27, 0.05);
        border: 1px solid #E1E4EA;
        border-radius: 4px;
      }

      /* Remove RGB input styles and add custom hex input styles */
      .hex-input-container {
        margin-top: 8px;
      }

      .hex-input-label {
        font-size: 10px;
        color: #99A0AE;
        margin-bottom: 4px;
      }

      .hex-input {
        width: 100%;
        height: 24px;
        font-size: 11px;
        color: #2B303B;
        padding: 0 8px;
        background: rgba(14, 18, 27, 0.05);
        border-radius: 4px;
      }

      /* Add styles for heading properties */
      .font-weight-options {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 4px;
        margin-bottom: 12px;
      }

      .font-weight-option {
        padding: 6px;
        text-align: center;
        background: rgba(14, 18, 27, 0.05);
        border-radius: 4px;
        font-size: 11px;
        color: #2B303B;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .font-weight-option.active {
        background: #2B303B;
        color: white;
      }

      .font-size-input {
        width: 100%;
        padding: 6px 8px;
        font-size: 11px;
        color: #2B303B;
        background: rgba(14, 18, 27, 0.05);
        border: none;
        border-radius: 4px;
        line-height: 1;
        height: fit-content;
        box-sizing: border-box;
      }

      .property-input {
        margin-bottom: 12px;

      }

      .property-input:last-child {
        margin-bottom: 0;
      }

      .property-input label {
        display: block;
        font-size: 11px;
        color: #99A0AE;
        margin-bottom: 4px;
      }

      .property-group {
        overflow-y: auto;
        max-height: calc(100vh - 300px);
      }

      /* Specific styling for heading color picker */
      #headingCustomColorPicker {
        position: absolute; /* Keep absolute for heading picker */
        top: auto;
        bottom: calc(100% + 8px);
        left: 0;
        box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.1);
      }

      #headingCustomColorPicker::after {
        content: '';
        position: absolute;
        bottom: -6px;
        left: 16px;
        width: 12px;
        height: 12px;
        background: white;
        border-right: 1px solid #E1E4EA;
        border-bottom: 1px solid #E1E4EA;
        transform: rotate(45deg);
      }
    </style>
  </head>
  <body>
    <!-- Main content area -->
    <div class="main-content">
      <h1 class="main-title">Thumbnail Generator</h1>
      <div class="sections-grid">
        <!-- Background section (full width) -->
        <div class="section" id="backgroundSection">
          <svg class="section-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13.0001 8.7175L8.01072 13.7069C7.91786 13.7998 7.80761 13.8734 7.68627 13.9237C7.56493 13.974 7.43487 13.9998 7.30353 13.9998C7.17219 13.9998 7.04213 13.974 6.92079 13.9237C6.79945 13.8734 6.6892 13.7998 6.59634 13.7069L1.29322 8.40375C1.20034 8.31089 1.12666 8.20064 1.07639 8.0793C1.02612 7.95796 1.00024 7.8279 1.00024 7.69656C1.00024 7.56522 1.02612 7.43517 1.07639 7.31383C1.12666 7.19249 1.20034 7.08224 1.29322 6.98938L7.28259 1L14.5001 8.2175L13.0001 8.7175Z" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M7.75 8.5C8.44036 8.5 9 7.94036 9 7.25C9 6.55964 8.44036 6 7.75 6C7.05964 6 6.5 6.55964 6.5 7.25C6.5 7.94036 7.05964 8.5 7.75 8.5Z" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M6.86614 6.36625L2.49927 2" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M15.5 13C15.5 13.2652 15.3946 13.5196 15.2071 13.7071C15.0196 13.8946 14.7652 14 14.5 14C14.2348 14 13.9804 13.8946 13.7929 13.7071C13.6054 13.5196 13.5 13.2652 13.5 13C13.5 12 14.5 10.5 14.5 10.5C14.5 10.5 15.5 12 15.5 13Z" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          <div class="section-title">Background</div>
          <div class="section-description">Customise the background</div>
        </div>

        <!-- Two-column sections -->
         <div class="two-column-sections"> 
           <div class="section" id="headingSection">
            <svg class="section-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M2.5 3.5V11" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9 7.25H2.5" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9 3.5V11" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M14 2L9 7L14 2Z" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>              
             <div class="section-title">Heading</div>
             <div class="section-description">Add project heading</div>
           </div>
   
           <div class="section" id="descriptionSection">
            <svg class="section-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 3.5V12.5" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3.5 5.5V3.5H12.5V5.5" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M6 12.5H10" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              
             <div class="section-title">Description</div>
             <div class="section-description">Add project description</div>
           </div>
         </div>

         <div class="two-column-sections">
          <div id="tagsSection" class="section">
            <svg class="section-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M13.5 8.5L8.5 13.5C8.36739 13.6326 8.19021 13.7066 8.00552 13.7066C7.82084 13.7066 7.64366 13.6326 7.51104 13.5L2.5 8.5V2.5H8.5L13.5 7.5V8.5Z" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M5 5H5.01" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <div class="section-title">Tags</div>
            <div class="section-description">Add project tags</div>
          </div>

          <div class="section" id="contributorsSection">
            <svg class="section-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 10C10.2091 10 12 8.20914 12 6C12 3.79086 10.2091 2 8 2C5.79086 2 4 3.79086 4 6C4 8.20914 5.79086 10 8 10Z" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M2 13.5C3.21063 11.4081 5.40937 10 8 10C10.5906 10 12.7894 11.4081 14 13.5" stroke="#222530" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              
            <div class="section-title">Contributors</div>
            <div class="section-description">Add project contributors</div>
          </div>
         </div>
      </div>
      <div class="button-container">
        <button id="generate">Generate thumbnail</button>
      </div>
    </div>

    <!-- Preview panel -->
    <div class="preview-panel">
      <!-- Preview section -->
         <div class="preview-header">
           Preview
         </div>
         <div class="preview-content">
           <div class="preview-placeholder">
             Select an element to preview
           </div>
         </div>

      
      <!-- Properties section -->

         <div class="properties-panel">
           <div class="properties-header">
              Properties    
           </div>
           <div class="properties-content">
             <!-- Background properties -->
             <div id="backgroundProperties" class="property-group" style="display: none;">
               <div class="property-input">
                 <!-- <label>Fill</label> -->
                 <div class="color-picker-wrapper">
                   <div class="color-preview" id="colorPreview">
                     <input type="color" class="color-input-hidden" id="backgroundColor" value="#FFFFFF">
                   </div>
                   <input type="text" id="hexInput" class="hex-input" value="#FFFFFF" maxlength="7">
                   
                   <!-- Custom color picker -->
                   <div class="custom-color-picker" id="customColorPicker">
                     <div class="saturation-value-picker" id="saturationValuePicker">
                       <div class="color-picker-thumb" id="saturationValueThumb"></div>
                     </div>
                     <div class="hue-slider color-slider" id="hueSlider">
                       <div class="color-picker-thumb" id="hueThumb"></div>
                     </div>
                     <div class="hex-input-container">
                       <div class="hex-input-label">Hex</div>
                       <input type="text" class="hex-input" id="hexInput" value="#FFFFFF" maxlength="7" placeholder="#000000">
                     </div>
                     <div class="preset-colors">
                       <div class="preset-color" style="background-color: #FFFFFF"></div>
                       <div class="preset-color" style="background-color: #F5F5F5"></div>
                       <div class="preset-color" style="background-color: #E1E4EA"></div>
                       <div class="preset-color" style="background-color: #2B303B"></div>
                       <div class="preset-color" style="background-color: #5E6AD2"></div>
                       <div class="preset-color" style="background-color: #0066FF"></div>
                       <div class="preset-color" style="background-color: #14AE5C"></div>
                       <div class="preset-color" style="background-color: #F24822"></div>
                     </div>
                   </div>
                 </div>
               </div>
             </div>

             <!-- Heading properties -->
             <div id="headingProperties" class="property-group" style="display: none;">
               <div class="property-input">
                 <label>Heading Text</label>
                 <input type="text" id="headingText" placeholder="Enter heading" onchange="updatePreview()">
               </div>

               <div class="property-input">
                 <label>Font Weight</label>
                 <div class="font-weight-options">
                   <div class="font-weight-option" data-weight="400">Regular</div>
                   <div class="font-weight-option" data-weight="500">Medium</div>
                   <div class="font-weight-option active" data-weight="600">Semi</div>
                   <div class="font-weight-option" data-weight="700">Bold</div>
                 </div>
               </div>

               <div class="property-input">
                 <label>Font Size</label>
                 <input type="number" id="headingSize" class="font-size-input" value="32" min="12" max="96" onchange="updatePreview()">
               </div>

               <div class="property-input">
                 <label>Color</label>
                 <div class="color-picker-wrapper">
                   <div class="color-preview" id="headingColorPreview">
                     <input type="color" class="color-input-hidden" id="headingColor" value="#000000" onchange="updatePreview()">
                   </div>
                   <input type="text" id="headingHexInput" class="hex-input" value="#000000" maxlength="7" onchange="updatePreview()">
                   
                   <!-- Custom color picker for heading -->
                   <div class="custom-color-picker" id="headingCustomColorPicker">
                     <div class="saturation-value-picker" id="headingSaturationValuePicker">
                       <div class="color-picker-thumb" id="headingSaturationValueThumb"></div>
                     </div>
                     <div class="hue-slider color-slider" id="headingHueSlider">
                       <div class="color-picker-thumb" id="headingHueThumb"></div>
                     </div>
                     <div class="hex-input-container">
                       <div class="hex-input-label">Hex</div>
                       <input type="text" class="hex-input" id="headingHexInputPicker" value="#000000" maxlength="7" placeholder="#000000">
                     </div>
                     <div class="preset-colors">
                       <div class="preset-color" style="background-color: #000000"></div>
                       <div class="preset-color" style="background-color: #2B303B"></div>
                       <div class="preset-color" style="background-color: #5E6AD2"></div>
                       <div class="preset-color" style="background-color: #0066FF"></div>
                       <div class="preset-color" style="background-color: #14AE5C"></div>
                       <div class="preset-color" style="background-color: #F24822"></div>
                     </div>
                   </div>
                 </div>
               </div>
             </div>

             <!-- Description properties -->
             <div id="descriptionProperties" class="property-group" style="display: none;">
               <div class="property-input">
                 <label>Description Text</label>
                 <textarea id="descriptionText" placeholder="Enter description"></textarea>
               </div>
               <div class="property-input">
                 <label>Font Size</label>
                 <input type="number" id="descriptionSize" value="16" min="10" max="48">
               </div>
               <div class="property-input">
                 <label>Color</label>
                 <input type="color" id="descriptionColor" value="#666666">
               </div>
             </div>

             <!-- Tags properties -->
             <div id="tagsProperties" class="property-group" style="display: none;">
               <div id="tagsList">
                 <!-- Tags will be listed here -->
               </div>
               <div id="tagPropertiesForm" style="display: none;">
                 <div class="property-input">
                   <label>Tag Text</label>
                   <input type="text" id="tagText" placeholder="Enter tag text">
                 </div>
                 <div class="property-input">
                   <label>Fill Color</label>
                   <input type="color" id="tagFillColor" value="#E1E4EA">
                 </div>
                 <div class="property-input">
                   <label>Text Color</label>
                   <input type="color" id="tagTextColor" value="#2B303B">
                 </div>
                 <div class="add-tag-form-buttons">
                   <button class="cancel" onclick="document.getElementById('tagPropertiesForm').style.display='none'">Cancel</button>
                   <button class="add" onclick="addNewTag(
                     document.getElementById('tagText').value,
                     document.getElementById('tagFillColor').value,
                     document.getElementById('tagTextColor').value
                   )">Add Tag</button>
                 </div>
               </div>
             </div>

             <!-- Contributors properties -->
             <div id="contributorsProperties" class="property-group" style="display: none;">
               <div class="property-input">
                 <label>Display Mode</label>
                 <select id="contributorsDisplayMode" onchange="state.contributors.displayMode = this.value; updatePreview();">
                   <option value="both">Show avatars and names</option>
                   <option value="avatars-only">Show avatars only</option>
                   <option value="names-only">Show names only</option>
                 </select>
               </div>
               
               <div id="contributorsList">
                 <!-- Contributors will be listed here -->
               </div>
               
               <div id="contributorPropertiesForm" style="display: none;">
                 <div class="property-input">
                   <label>Name</label>
                   <input type="text" id="contributorName" placeholder="Enter contributor name">
                 </div>
                 <div class="property-input">
                   <label>Avatar URL</label>
                   <input type="text" id="contributorAvatarUrl" placeholder="Enter avatar URL">
                 </div>
                 <div class="add-tag-form-buttons">
                   <button class="cancel" onclick="document.getElementById('contributorPropertiesForm').style.display='none'">Cancel</button>
                   <button class="add" onclick="addNewContributor(
                     document.getElementById('contributorName').value,
                     document.getElementById('contributorAvatarUrl').value
                   )">Add Contributor</button>
                 </div>
               </div>
             </div>
           </div>
         </div>

    </div>

    <script>
      // Get all sections and property groups
      const sections = document.querySelectorAll('.section');
      const propertyGroups = document.querySelectorAll('.property-group');
      const propertiesHeader = document.querySelector('.properties-header');
      const previewContent = document.querySelector('.preview-content');
      const previewPlaceholder = document.querySelector('.preview-placeholder');
      const generateButton = document.getElementById('generate');

      // State object to store current values
      const state = {
        background: {
          color: '#FFFFFF',
        },
        heading: {
          text: '',
          size: 32,
          color: '#000000',
          fontWeight: '600'
        },
        description: {
          text: '',
          size: 16,
          color: '#666666'
        },
        tags: [],
        contributors: {
          items: [],
          displayMode: 'both' // 'avatars-only' | 'names-only' | 'both'
        }
      };

      // Get all input elements
      const backgroundColorInput = document.getElementById('backgroundColor');
      const headingTextInput = document.getElementById('headingText');
      const headingSizeInput = document.getElementById('headingSize');
      const headingColorInput = document.getElementById('headingColor');
      const descriptionTextInput = document.getElementById('descriptionText');
      const descriptionSizeInput = document.getElementById('descriptionSize');
      const descriptionColorInput = document.getElementById('descriptionColor');

      // Add input event listeners
      backgroundColorInput.addEventListener('input', (e) => {
        state.background.color = e.target.value;
        updatePreview();
      });

      headingTextInput.addEventListener('input', (e) => {
        state.heading.text = e.target.value;
        updatePreview();
      });

      headingSizeInput.addEventListener('input', (e) => {
        state.heading.size = parseInt(e.target.value);
        updatePreview();
      });

      headingColorInput.addEventListener('input', (e) => {
        state.heading.color = e.target.value;
        updatePreview();
      });

      descriptionTextInput.addEventListener('input', (e) => {
        state.description.text = e.target.value;
        updatePreview();
      });

      descriptionSizeInput.addEventListener('input', (e) => {
        state.description.size = parseInt(e.target.value);
        updatePreview();
      });

      descriptionColorInput.addEventListener('input', (e) => {
        state.description.color = e.target.value;
        updatePreview();
      });

      // Add click event listeners for sections
      sections.forEach(section => {
        section.addEventListener('click', () => {
          // Remove active class from all sections
          sections.forEach(s => s.classList.remove('active'));
          
          // Add active class to clicked section
          section.classList.add('active');
          
          // Get the corresponding properties group ID
          const propertiesId = section.id.replace('Section', 'Properties');
          
          // Show the corresponding properties
          showPropertyGroup(propertiesId);
        });
      });

      function showPropertyGroup(groupId) {
        // Hide all property groups first
        propertyGroups.forEach(group => {
          group.style.display = 'none';
        });
        
        // Show the selected group
        const selectedGroup = document.getElementById(groupId);
        if (selectedGroup) {
          selectedGroup.style.display = 'block';
        }

        // Update properties header text and button
        propertiesHeader.innerHTML = '';  // Clear existing content
        
        // Add the title text
        const titleText = document.createElement('span');
        const activeSection = document.querySelector('.section.active');
        titleText.textContent = activeSection.querySelector('.section-title').textContent + ' Properties';
        propertiesHeader.appendChild(titleText);

        // Add the "Add new tag" button if we're showing tag properties
        if (groupId === 'tagsProperties') {
          const addButton = document.createElement('button');
          addButton.className = 'add-tag-header-button';
          addButton.innerHTML = `
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 2.5V9.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M2.5 6H9.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Add new tag</span>
          `;
          addButton.onclick = () => {
            const tagPropertiesForm = document.getElementById('tagPropertiesForm');
            if (tagPropertiesForm) {
              tagPropertiesForm.style.display = 'block';
            }
          };
          propertiesHeader.appendChild(addButton);
        }

        // Add the "Add new contributor" button if we're showing contributor properties
        if (groupId === 'contributorsProperties') {
          const addButton = document.createElement('button');
          addButton.className = 'add-tag-header-button';
          addButton.innerHTML = `
            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 2.5V9.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M2.5 6H9.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Add new contributor</span>
          `;
          addButton.onclick = () => {
            const contributorPropertiesForm = document.getElementById('contributorPropertiesForm');
            if (contributorPropertiesForm) {
              contributorPropertiesForm.style.display = 'block';
            }
          };
          propertiesHeader.appendChild(addButton);
        }
      }

      // Add function to handle adding new tags
      function addNewTag(text, fillColor, textColor) {
        const tag = {
          text,
          fillColor,
          textColor
        };
        
        state.tags.push(tag);
        
        // Update tags list
        updateTagsList();
        
        // Update preview
        updatePreview();
      }

      // Add function to update tags list
      function updateTagsList() {
        const tagsList = document.getElementById('tagsList');
        tagsList.innerHTML = '';
        
        state.tags.forEach((tag, index) => {
          const tagItem = document.createElement('div');
          tagItem.className = 'tag-item';
          tagItem.innerHTML = `
            <div class="tag-header">
              <span class="tag-title">${tag.text}</span>
              <button class="remove-tag" onclick="removeTag(${index})">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 3L3 9" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M3 3L9 9" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
            <div class="tag-preview" style="background-color: ${tag.fillColor}; color: ${tag.textColor}">
              ${tag.text}
            </div>
          `;
          tagsList.appendChild(tagItem);
        });
      }

      // Add function to remove tags
      function removeTag(index) {
        state.tags.splice(index, 1);
        updateTagsList();
        updatePreview();
      }

      // Add function to handle adding new contributors
      function addNewContributor(name, avatarUrl) {
        const contributor = {
          name,
          avatarUrl
        };
        
        state.contributors.items.push(contributor);
        updateContributorsList();
        updatePreview();
      }

      // Add function to update contributors list
      function updateContributorsList() {
        const contributorsList = document.getElementById('contributorsList');
        contributorsList.innerHTML = '';
        
        state.contributors.items.forEach((contributor, index) => {
          const contributorItem = document.createElement('div');
          contributorItem.className = 'contributor-item';
          contributorItem.innerHTML = `
            <div class="contributor-header">
              <span class="contributor-title">${contributor.name}</span>
              <button class="remove-contributor" onclick="removeContributor(${index})">
                <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M9 3L3 9" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M3 3L9 9" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </button>
            </div>
            <div class="contributor-preview">
              <div class="contributor-avatar" style="background-image: url(${contributor.avatarUrl})"></div>
              <span>${contributor.name}</span>
            </div>
          `;
          contributorsList.appendChild(contributorItem);
        });
      }

      // Add function to remove contributors
      function removeContributor(index) {
        state.contributors.items.splice(index, 1);
        updateContributorsList();
        updatePreview();
      }

      // Initialize when DOM is loaded
      window.addEventListener('DOMContentLoaded', () => {
        // Show background section properties by default
        const backgroundSection = document.getElementById('backgroundSection');
        if (backgroundSection) {
          backgroundSection.classList.add('active');
          showPropertyGroup('backgroundProperties');
          propertiesHeader.textContent = 'Background Properties';
        }

        // Initialize preview with default state
        updatePreview();
      });

      function updatePreview() {
        // Update background
        previewContent.style.background = state.background.color;

        // Clear existing preview content except placeholder
        const elements = previewContent.querySelectorAll(':not(.preview-placeholder)');
        elements.forEach(el => el.remove());

        // Create preview elements container
        const previewElements = document.createElement('div');
        previewElements.className = 'preview-elements';

        // Add heading if exists
        if (state.heading.text) {
          const heading = document.createElement('div');
          heading.className = 'preview-heading';
          heading.textContent = state.heading.text;
          heading.style.fontSize = `${state.heading.size}px`;
          heading.style.color = state.heading.color;
          heading.style.fontWeight = state.heading.fontWeight;
          previewElements.appendChild(heading);
        }

        // Add description if exists
        if (state.description.text) {
          const description = document.createElement('div');
          description.className = 'preview-description';
          description.textContent = state.description.text;
          description.style.fontSize = `${state.description.size}px`;
          description.style.color = state.description.color;
          previewElements.appendChild(description);
        }

        // Add elements to preview if there's content
        if (state.heading.text || state.description.text) {
          previewContent.appendChild(previewElements);
          previewPlaceholder.style.display = 'none';
        } else {
          previewPlaceholder.style.display = 'block';
        }
      }

      // Handle generate button click
      generateButton.addEventListener('click', () => {
        parent.postMessage({ 
            pluginMessage: {
              type: 'generate-thumbnail',
            heading: state.heading.text,
            description: state.description.text,
            styles: {
              background: state.background,
              heading: {
                size: state.heading.size,
                color: state.heading.color,
                font: 'Inter',
                weight: state.heading.fontWeight
              },
              description: {
                size: state.description.size,
                color: state.description.color,
                font: 'Inter',
                weight: 'Regular'
              },
              contributors: state.contributors
            }
          }
        }, '*');
      });

      // Color picker functionality
      const colorInput = document.getElementById('backgroundColor');
      const colorPreview = document.getElementById('colorPreview');
      const hexInput = document.getElementById('hexInput');
      const customColorPicker = document.getElementById('customColorPicker');
      const saturationValuePicker = document.getElementById('saturationValuePicker');
      const hueSlider = document.getElementById('hueSlider');
      const saturationValueThumb = document.getElementById('saturationValueThumb');
      const hueThumb = document.getElementById('hueThumb');

      // Color picker state
      let currentHsv = { h: 0, s: 0, v: 1 }; // Start with white
      let isHueChanging = false;
      let isSaturationValueChanging = false;

      function updateColorFromHSV() {
        const rgb = hsvToRgb(currentHsv.h, currentHsv.s, currentHsv.v);
        const hex = rgbToHex(rgb.r, rgb.g, rgb.b);
        
        // Update all color inputs
        document.getElementById('backgroundColor').value = hex;
        document.getElementById('hexInput').value = hex;
        colorPreview.style.backgroundColor = hex;
        
        // Update picker UI
        saturationValuePicker.style.background = `hsl(${currentHsv.h}, 100%, 50%)`;
        saturationValueThumb.style.left = `${currentHsv.s * 100}%`;
        saturationValueThumb.style.top = `${(1 - currentHsv.v) * 100}%`;
        hueThumb.style.left = `${(currentHsv.h / 360) * 100}%`;
        
        // Update state
        state.background.color = hex;
        updatePreview();
      }

      // Toggle color picker
      colorPreview.addEventListener('click', () => {
        const allPickers = document.querySelectorAll('.custom-color-picker');
        allPickers.forEach(picker => {
          if (picker !== customColorPicker) {
            picker.style.display = 'none';
          }
        });

        if (customColorPicker.style.display === 'none') {
          const rect = colorPreview.getBoundingClientRect();
          customColorPicker.style.top = `${rect.bottom + 2}px`;
          customColorPicker.style.left = `${rect.left}px`;
          customColorPicker.style.display = 'block';
        } else {
          customColorPicker.style.display = 'none';
        }
      });

      // Handle hue slider
      hueSlider.addEventListener('mousedown', startHueChange);
      document.addEventListener('mousemove', handleHueChange);
      document.addEventListener('mouseup', stopHueChange);

      function startHueChange(e) {
        isHueChanging = true;
        handleHueChange(e);
        hueSlider.style.cursor = 'grabbing';
      }

      function handleHueChange(e) {
        if (!isHueChanging) return;
        const rect = hueSlider.getBoundingClientRect();
        let x = (e.clientX - rect.left) / rect.width;
        x = Math.max(0, Math.min(1, x));
        currentHsv.h = x * 360;
        updateColorFromHSV();
      }

      function stopHueChange() {
        isHueChanging = false;
        hueSlider.style.cursor = 'pointer';
      }

      // Handle saturation-value picker
      saturationValuePicker.addEventListener('mousedown', startSaturationValueChange);
      document.addEventListener('mousemove', handleSaturationValueChange);
      document.addEventListener('mouseup', stopSaturationValueChange);

      function startSaturationValueChange(e) {
        isSaturationValueChanging = true;
        handleSaturationValueChange(e);
        saturationValuePicker.style.cursor = 'grabbing';
      }

      function handleSaturationValueChange(e) {
        if (!isSaturationValueChanging) return;
        const rect = saturationValuePicker.getBoundingClientRect();
        let x = (e.clientX - rect.left) / rect.width;
        let y = (e.clientY - rect.top) / rect.height;
        x = Math.max(0, Math.min(1, x));
        y = Math.max(0, Math.min(1, y));
        currentHsv.s = x;
        currentHsv.v = 1 - y;
        updateColorFromHSV();
      }

      function stopSaturationValueChange() {
        isSaturationValueChanging = false;
        saturationValuePicker.style.cursor = 'crosshair';
      }

      // Handle hex input
      hexInput.addEventListener('input', (e) => {
        const color = e.target.value;
        if (/^#[0-9A-F]{6}$/i.test(color)) {
          const rgb = hexToRgb(color);
          const hsv = rgbToHsv(rgb.r, rgb.g, rgb.b);
          currentHsv = hsv;
          updateColorFromHSV();
        }
      });

      // Handle preset colors
      const presetColors = document.querySelectorAll('.preset-color');
      presetColors.forEach(preset => {
        preset.addEventListener('click', () => {
          const color = preset.style.backgroundColor;
          const rgb = color.match(/\d+/g).map(Number);
          const hsv = rgbToHsv(rgb[0], rgb[1], rgb[2]);
          currentHsv = hsv;
          updateColorFromHSV();
        });
      });

      // Initialize when DOM is loaded
      window.addEventListener('DOMContentLoaded', () => {
        const currentColor = document.getElementById('backgroundColor').value;
        const rgb = hexToRgb(currentColor);
        const hsv = rgbToHsv(rgb.r, rgb.g, rgb.b);
        currentHsv = hsv;
        updateColorFromHSV();
      });

      // Convert HSV to RGB
      function hsvToRgb(h, s, v) {
        s /= 100;
        v /= 100;
        const i = Math.floor(h / 60);
        const f = h / 60 - i;
        const p = v * (1 - s);
        const q = v * (1 - f * s);
        const t = v * (1 - (1 - f) * s);
        let r, g, b;
        switch (i % 6) {
          case 0: r = v; g = t; b = p; break;
          case 1: r = q; g = v; b = p; break;
          case 2: r = p; g = v; b = t; break;
          case 3: r = p; g = q; b = v; break;
          case 4: r = t; g = p; b = v; break;
          case 5: r = v; g = p; b = q; break;
        }
        return {
          r: Math.round(r * 255),
          g: Math.round(g * 255),
          b: Math.round(b * 255)
        };
      }

      // Convert RGB to HSV
      function rgbToHsv(r, g, b) {
        r /= 255;
        g /= 255;
        b /= 255;
        const max = Math.max(r, g, b);
        const min = Math.min(r, g, b);
        let h, s, v = max;
        const d = max - min;
        s = max === 0 ? 0 : d / max;
        if (max === min) {
          h = 0;
        } else {
          switch (max) {
            case r: h = (g - b) / d + (g < b ? 6 : 0); break;
            case g: h = (b - r) / d + 2; break;
            case b: h = (r - g) / d + 4; break;
          }
          h /= 6;
        }
        return {
          h: h * 360,
          s: s * 100,
          v: v * 100
        };
      }

      // Convert RGB to Hex
      function rgbToHex(r, g, b) {
        return `#${((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1).toUpperCase()}`;
      }

      // Convert Hex to RGB
      function hexToRgb(hex) {
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
          r: parseInt(result[1], 16),
          g: parseInt(result[2], 16),
          b: parseInt(result[3], 16)
        } : null;
      }

      // Add event listeners for font weight options
      document.querySelectorAll('.font-weight-option').forEach(option => {
        option.addEventListener('click', () => {
          // Remove active class from all options
          document.querySelectorAll('.font-weight-option').forEach(opt => opt.classList.remove('active'));
          // Add active class to clicked option
          option.classList.add('active');
          // Update preview
          state.heading.fontWeight = option.dataset.weight;
          updatePreview();
        });
      });

      // Initialize heading color picker
      const headingColorPreview = document.getElementById('headingColorPreview');
      const headingColor = document.getElementById('headingColor');
      const headingHexInput = document.getElementById('headingHexInput');

      headingColor.addEventListener('input', (e) => {
        const color = e.target.value;
        headingColorPreview.style.backgroundColor = color;
        headingHexInput.value = color;
        state.heading.color = color;
        updatePreview();
      });

      headingHexInput.addEventListener('input', (e) => {
        const color = e.target.value;
        if (/^#[0-9A-F]{6}$/i.test(color)) {
          headingColorPreview.style.backgroundColor = color;
          headingColor.value = color;
          state.heading.color = color;
          updatePreview();
        }
      });

      // Initialize heading custom color picker
      const headingCustomColorPicker = document.getElementById('headingCustomColorPicker');
      const headingHueSlider = document.getElementById('headingHueSlider');
      const headingSaturationValuePicker = document.getElementById('headingSaturationValuePicker');
      
      let headingHsv = { h: 0, s: 0, v: 0 };
      let isHeadingHueChanging = false;
      let isHeadingSaturationValueChanging = false;

      headingColorPreview.addEventListener('click', () => {
        const allPickers = document.querySelectorAll('.custom-color-picker');
        allPickers.forEach(picker => {
          if (picker !== headingCustomColorPicker) {
            picker.style.display = 'none';
          }
        });
        headingCustomColorPicker.style.display = headingCustomColorPicker.style.display === 'none' ? 'block' : 'none';
      });

      // Handle heading hue slider
      headingHueSlider.addEventListener('mousedown', (e) => {
        isHeadingHueChanging = true;
        handleHeadingHueChange(e);
      });

      document.addEventListener('mousemove', (e) => {
        if (isHeadingHueChanging) {
          handleHeadingHueChange(e);
        }
      });

      document.addEventListener('mouseup', () => {
        isHeadingHueChanging = false;
      });

      function handleHeadingHueChange(e) {
        if (!isHeadingHueChanging) return;
        const rect = headingHueSlider.getBoundingClientRect();
        let x = (e.clientX - rect.left) / rect.width;
        x = Math.max(0, Math.min(1, x));
        headingHsv.h = x * 360;
        updateHeadingColorFromHSV();
      }

      // Handle heading saturation-value picker
      headingSaturationValuePicker.addEventListener('mousedown', (e) => {
        isHeadingSaturationValueChanging = true;
        handleHeadingSaturationValueChange(e);
      });

      document.addEventListener('mousemove', (e) => {
        if (isHeadingSaturationValueChanging) {
          handleHeadingSaturationValueChange(e);
        }
      });

      document.addEventListener('mouseup', () => {
        isHeadingSaturationValueChanging = false;
      });

      function handleHeadingSaturationValueChange(e) {
        if (!isHeadingSaturationValueChanging) return;
        const rect = headingSaturationValuePicker.getBoundingClientRect();
        let x = (e.clientX - rect.left) / rect.width;
        let y = (e.clientY - rect.top) / rect.height;
        x = Math.max(0, Math.min(1, x));
        y = Math.max(0, Math.min(1, y));
        headingHsv.s = x;
        headingHsv.v = 1 - y;
        updateHeadingColorFromHSV();
      }

      function updateHeadingColorFromHSV() {
        const rgb = hsvToRgb(headingHsv.h, headingHsv.s, headingHsv.v);
        const hex = rgbToHex(rgb.r, rgb.g, rgb.b);
        
        document.getElementById('headingColor').value = hex;
        document.getElementById('headingHexInput').value = hex;
        document.getElementById('headingHexInputPicker').value = hex;
        
        headingSaturationValuePicker.style.background = `hsl(${headingHsv.h}, 100%, 50%)`;
        headingSaturationValueThumb.style.left = `${headingHsv.s * 100}%`;
        headingSaturationValueThumb.style.top = `${(1 - headingHsv.v) * 100}%`;
        headingHueThumb.style.left = `${(headingHsv.h / 360) * 100}%`;
        
        updatePreview();
      }

      // Handle heading hex input
      document.getElementById('headingHexInputPicker').addEventListener('input', (e) => {
        const color = e.target.value;
        if (/^#[0-9A-F]{6}$/i.test(color)) {
          const rgb = hexToRgb(color);
          const hsv = rgbToHsv(rgb.r, rgb.g, rgb.b);
          headingHsv = hsv;
          updateHeadingColorFromHSV();
        }
      });

      // Handle heading preset colors
      const headingPresetColors = headingCustomColorPicker.querySelectorAll('.preset-color');
      headingPresetColors.forEach(preset => {
        preset.addEventListener('click', () => {
          const color = preset.style.backgroundColor;
          const rgb = color.match(/\d+/g).map(Number);
          const hsv = rgbToHsv(rgb[0], rgb[1], rgb[2]);
          headingHsv = hsv;
          updateHeadingColorFromHSV();
        });
      });

      // Handle clicking outside color pickers
      document.addEventListener('click', (e) => {
        const backgroundColorPreview = document.getElementById('colorPreview');
        const headingColorPreview = document.getElementById('headingColorPreview');
        const backgroundPicker = document.getElementById('customColorPicker');
        const headingPicker = document.getElementById('headingCustomColorPicker');

        // Check if click is outside both color pickers and their preview buttons
        if (!backgroundColorPreview.contains(e.target) && 
            !headingColorPreview.contains(e.target) && 
            !backgroundPicker.contains(e.target) && 
            !headingPicker.contains(e.target)) {
          // Hide both pickers
          backgroundPicker.style.display = 'none';
          headingPicker.style.display = 'none';
        }
      });

      // Prevent color picker from closing when clicking inside it
      const colorPickers = document.querySelectorAll('.custom-color-picker');
      colorPickers.forEach(picker => {
        picker.addEventListener('click', (e) => {
          e.stopPropagation();
        });
      });
    </script>
  </body>
</html>
